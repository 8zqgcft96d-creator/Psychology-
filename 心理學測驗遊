<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>行為傾向雷達圖分析</title>
    <!-- 載入 Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 載入 Chart.js 繪圖庫 -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <style>
        /* 確保字體在 Chart.js 中能正常顯示中文 */
        body { font-family: 'Inter', 'Noto Sans TC', sans-serif; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-4 sm:p-8">
    <div class="max-w-4xl mx-auto bg-white shadow-xl rounded-xl p-6 md:p-10">
        <h1 class="text-3xl font-bold text-gray-800 mb-2">四種行為傾向的雷達圖分析</h1>
        <p class="text-gray-500 mb-6 border-b pb-4">
            此雷達圖將馬型、男孩型、狐狸型、鼴鼠型四種型別，在四個核心行為維度上的傾向進行量化比較（分數範圍 1-5）。
        </p>

        <!-- 雷達圖容器 -->
        <div class="w-full h-[400px] md:h-[500px] bg-gray-50 p-4 rounded-lg border">
            <canvas id="tendencyRadarChart"></canvas>
        </div>

        <!-- 下載操作區 -->
        <div class="mt-6 flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4">
            <button id="downloadImageBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150 shadow-md">
                下載雷達圖 (PNG)
            </button>
            <button id="downloadDataBtn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition duration-150 shadow-md">
                下載分析數據 (CSV)
            </button>
        </div>

        <!-- 數據分析表格 -->
        <div class="mt-8">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">行為傾向維度評分（1-5分，5分最高）</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200 rounded-lg overflow-hidden">
                    <thead class="bg-blue-50">
                        <tr>
                            <th scope="col" class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">型別</th>
                            <th scope="col" class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">A: 行動力/挑戰性</th>
                            <th scope="col" class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">B: 思考深度/內在探索</th>
                            <th scope="col" class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">C: 謹慎性/安全感</th>
                            <th scope="col" class="px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">D: 支援性/關係導向</th>
                        </tr>
                    </thead>
                    <tbody id="data-table-body" class="bg-white divide-y divide-gray-200">
                        <!-- 數據將由 JS 填充 -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // 設定 Chart.js 全局字體為 Noto Sans TC (或 fallback)
        Chart.defaults.font.family = 'Inter, "Noto Sans TC", sans-serif';
        Chart.defaults.color = '#374151'; // 設置預設文字顏色

        let radarChartInstance = null; // 用於保存 Chart 實例

        // 1. 定義雷達圖的軸線標籤 (對應測驗選項 A, B, C, D)
        const labels = [
            'A: 行動力/挑戰性',
            'B: 思考深度/內在探索',
            'C: 謹慎性/安全感',
            'D: 支援性/關係導向'
        ];

        // 2. 根據四種型別的描述，量化為 1-5 分的數據
        const profileData = [
            {
                label: '馬型 (Horse Type)',
                color: 'rgba(245, 158, 11, 0.8)', // Amber (高行動, 高支援)
                data: [4, 3, 3, 5], 
                description: '習慣扛責任、提供安全感。'
            },
            {
                label: '男孩型 (Boy Type)',
                color: 'rgba(59, 130, 246, 0.8)', // Blue (高思考, 高支援/敏感)
                data: [2, 5, 4, 4], 
                description: '強感受力、不斷自我檢討。'
            },
            {
                label: '狐狸型 (Fox Type)',
                color: 'rgba(239, 68, 68, 0.8)', // Red (高謹慎, 高思考, 低關係)
                data: [2, 4, 5, 1], 
                description: '敏銳細心、保持界線、追求確定。'
            },
            {
                label: '鼴鼠型 (Mole Type)',
                color: 'rgba(16, 185, 129, 0.8)', // Emerald Green (高支援, 低行動/理性分析)
                data: [1, 2, 3, 5], 
                description: '重視舒服感、照顧情緒、提供溫柔支持。'
            }
        ];

        // 3. 準備 Chart.js 的 Dataset
        const datasets = profileData.map(profile => ({
            label: profile.label,
            data: profile.data,
            fill: true,
            backgroundColor: profile.color.replace('0.8', '0.2'), // 填充色更透明
            borderColor: profile.color.replace('0.8', '1'),
            pointBackgroundColor: profile.color.replace('0.8', '1'),
            pointBorderColor: '#fff',
            pointHoverBackgroundColor: '#fff',
            pointHoverBorderColor: profile.color.replace('0.8', '1')
        }));

        // 4. 繪製雷達圖
        function initializeChart() {
            const ctx = document.getElementById('tendencyRadarChart').getContext('2d');
            if (radarChartInstance) {
                radarChartInstance.destroy(); // 銷毀舊實例以避免重複繪製
            }
            
            radarChartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false, // 允許容器控制大小
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                font: { size: 14 }
                            }
                        },
                        title: {
                            display: true,
                            text: '四種行為傾向的綜合雷達圖',
                            font: { size: 18, weight: 'bold' }
                        }
                    },
                    scales: {
                        r: {
                            angleLines: { display: true, color: 'rgba(100, 100, 100, 0.2)' },
                            grid: { color: 'rgba(100, 100, 100, 0.3)' },
                            pointLabels: {
                                font: { size: 12, weight: 'bold' },
                                color: '#4b5563'
                            },
                            // 設定分數範圍 0-5
                            min: 0,
                            max: 5,
                            stepSize: 1,
                            ticks: {
                                display: true,
                                backdropColor: "rgba(255, 255, 255, 0.8)",
                                font: { size: 12 }
                            }
                        }
                    }
                }
            });
        }

        // 5. 填充數據表格
        function populateTable() {
            const tableBody = document.getElementById('data-table-body');
            tableBody.innerHTML = ''; // 清空舊數據
            profileData.forEach(profile => {
                const row = tableBody.insertRow();
                row.className = 'hover:bg-gray-50';
                
                // 型別名稱
                let cell = row.insertCell();
                cell.textContent = profile.label;
                cell.className = 'px-3 py-4 whitespace-nowrap text-sm font-medium text-gray-900';
                
                // 四個分數
                profile.data.forEach(score => {
                    let scoreCell = row.insertCell();
                    scoreCell.textContent = score;
                    scoreCell.className = 'px-3 py-4 whitespace-nowrap text-sm text-gray-500';
                });
            });
        }
        
        // 6. 下載圖表 (PNG)
        document.getElementById('downloadImageBtn').addEventListener('click', () => {
            if (radarChartInstance) {
                const link = document.createElement('a');
                link.download = '行為傾向雷達圖_分析結果.png';
                link.href = radarChartInstance.toBase64Image();
                link.click();
            }
        });

        // 7. 下載數據 (CSV)
        document.getElementById('downloadDataBtn').addEventListener('click', () => {
            // 建立 CSV 標頭
            const csvHeader = '型別名稱,A:行動力/挑戰性,B:思考深度/內在探索,C:謹慎性/安全感,D:支援性/關係導向\n';
            
            // 建立 CSV 內容
            const csvRows = profileData.map(profile => {
                const scores = profile.data.join(',');
                return `"${profile.label}",${scores}`;
            }).join('\n');

            const csvContent = csvHeader + csvRows;
            
            // 建立 Blob 並觸發下載
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            
            link.setAttribute('href', url);
            link.setAttribute('download', '行為傾向分析數據.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });


        // 頁面加載完成後初始化
        window.onload = function () {
            initializeChart();
            populateTable();
        }
    </script>
</body>
</html>
